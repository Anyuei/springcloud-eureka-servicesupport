<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>CouldComment</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="robots" content="all,follow">
    <!-- Bootstrap CSS-->
    <link rel="stylesheet" href="${request.contextPath }/vendor/bootstrap/css/bootstrap.min.css">
    <!-- Font Awesome CSS-->
    <link rel="stylesheet" href="${request.contextPath }/vendor/font-awesome/css/font-awesome.min.css">
    <!-- Fontastic Custom icon font-->
    <link rel="stylesheet" href="${request.contextPath }/css/fontastic.css">
    <!-- Google fonts - Poppins -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Poppins:300,400,700">
    <!-- theme stylesheet-->
    <link rel="stylesheet" href="${request.contextPath }/css/style.default.css" id="theme-stylesheet">
    <!-- Custom stylesheet - for your changes-->
    <link rel="stylesheet" href="${request.contextPath }/css/custom.css">
    <!-- Favicon-->
    <link rel="shortcut icon" href="${request.contextPath }/img/favicon.ico">
    <!-- Tweaks for older IEs--><!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
        <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <script src="${request.contextPath }/vendor/jquery/jquery.min.js"></script>
  </head>
  <style>

    .container {
      padding: 0px 0px;
      margin: 0px auto;
      max-width: 1000px;
    }

    .jumbotron {
      padding: 4rem 2rem;
    }

    .bigBackgroundImg {
      height: 30%;
      background-color: #000000;
      -moz-box-shadow: 2px 2px 5px #333333;
      -webkit-box-shadow: 2px 2px 5px #333333;
      box-shadow: 0px 0px 23px 15px #00000078;
      padding: 0px 0px 0px 0px;
    }

    .modal-content {
      background-color: #e8f3ffe3;
      border: 0px solid rgba(0, 0, 0, .2);
      border-radius: 31px;
      box-shadow: 0px 0px 40px 21px rgba(255, 255, 255, 0.51);
      -webkit-box-shadow: 0px 0px 40px 21px rgba(255, 255, 255, 0.51);
      box-shadow: 0px 0px 40px 21px rgba(255, 255, 255, 0.51);
    }
    .form-control {
      background-color: #ffffff;
      border: 0px solid #f00;
      border-radius: 4px;
    }
    label {
      display: inline-block;
      margin: 10px 0px 10px 0px;
    }
    .commentBtn{
      margin: 20px 25px 5px 25px;
    }
      .disappear{
          display: none;
      }
    #operationBar{
        background-color: #138496;
    }
  </style>
  <body>
    <div class="page">
      <!-- Main Navbar 主页面头部-->
      <#include "/header.html"/>
      <div class="container">
          <div class="objectID disappear">${item.objectID!''}</div>
        <div class="bigBackgroundImg container" align="center">
          <!-- 轮播图 -->
          <div id="carouselExampleIndicators" class="carousel slide">
            <ol class="carousel-indicators">
                <#list 0..img_paths_length-1 as i>
                  <li data-target="#carouselExampleIndicators" data-slide-to=${i}></li>
                </#list>
            </ol>
            <div class="carousel-inner">
              <#list img_paths as img_path>
                  <div class="carousel-item" >
                    <img class="d-block w-100" src="${img_path!'图片加载失败'}" alt="图片加载失败">
                    <div class="carousel-caption d-none d-md-block">
                      <h5>${item.objectName!''}</h5>
                      <p>${item.brief_introduction!''}</p>
                    </div>
                  </div>
              </#list>
            </div>
            <a class="carousel-control-prev" href="#carouselExampleIndicators" role="button" data-slide="prev">
              <span class="carousel-control-prev-icon" aria-hidden="true"></span>
              <span class="sr-only">Previous</span>
            </a>
            <a class="carousel-control-next" href="#carouselExampleIndicators" role="button" data-slide="next">
              <span class="carousel-control-next-icon" aria-hidden="true"></span>
              <span class="sr-only">Next</span>
            </a>
          </div>
        <!-- 轮播图 end-->
        </div>
        <div id="operationBar">
            <button type="button" class="btn btn-primary" data-toggle="modal" data-target=".bd-example-modal-lg" s>发表态度</button>
        </div>

        <!-- 评论区 -->
        <div class="jumbotron container" id="commentArea">


              <!--评论弹窗-->
              <div class="modal fade bd-example-modal-lg" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel">
                <div class="modal-dialog modal-lg">
                  <div class="modal-content">
                    <div class="modal-body">
                      <button class="close" data-dismiss="modal">
                        <span>×</span>
                      </button>
                    </div>
                    <div class="modal-title">
                      <h2 class="text-center">发表态度</h2>
                    </div>
                    <div class="modal-body">
                      <form class="form-group" id="CommentForm" action="" style="margin-bottom: 0px;">
                        <div class="form-group" style="margin-bottom: 0px;">
                          <label for="">你的印象：</label>
                          <input class="form-control" type="text" id="CommentContent" placeholder="">
                        </div>
                        <div class="text-right">
                          <button class="btn btn-primary commentBtn" type="submit" style="background-color: #3a8cd2b3; border: 0px solid transparent;">提交</button>
                          <button class="btn btn-danger commentBtn" data-dismiss="modal" style="background-color: #fb5e5999;border: 0px solid transparent;">取消</button>
                        </div>
                      </form>
                    </div>
                  </div>
                </div>
              </div>
            <!--评论弹窗 end-->
          </div>
      <!-- 评论区 end-->
      </div>
    </div>
    <!-- JavaScript files-->
    <script src="${request.contextPath }/vendor/popper.js/umd/popper.min.js"> </script>
    <script src="${request.contextPath }/vendor/bootstrap/js/bootstrap.min.js"></script>
    <script src="${request.contextPath }/vendor/jquery.cookie/jquery.cookie.js"> </script>
    <script src="${request.contextPath }/vendor/chart.js/Chart.min.js"></script>
    <script src="${request.contextPath }/vendor/jquery-validation/jquery.validate.min.js"></script>
    <script src="${request.contextPath }/js/charts-home.js"></script>
    <!-- Main File-->
    <script src="${request.contextPath }/js/front.js"></script>
  </body>
<script>
    /*视频上传表单验证*/
    function checkVideoUpload(){
        if($("#videoname").val()==""){
            alert("请输入视频名")
            return false;
        }
        if($("#uploadFile").val()==""){
            alert("请上传视频")
            return false;
        }
        if($("#fileMD5").val()==""){
            alert("MD5未生成，请重新选择文件")
            return false;
        }
        return true;
    }
    /*文件MD5散列码生成*/
    function processFiles(files) {
        var file = files[0];
        var reader = new FileReader();
        reader.onload = function(e) {
            //把生成的散列码回显到文件下方，方便复制，更作为表单提交
            $("#fileMD5").val(SparkMD5.hashBinary(e.target.result))
            $("#uploadVideobtn").removeAttr("disabled");
        };
        //reader.readAsText(file);
        //reader.readAsArrayBuffer(file);
        //reader.readAsDataURL(file);
        reader.readAsBinaryString(file)
    }

    $(function () {
        $(".carousel-inner .carousel-item").first().addClass("active");
        $(".carousel-indicators li").first().addClass("active");
        var objectID = $(".objectID").text();
        getComments(objectID);

    })

    function getComments(objectID) {
        console.log("评论获取成功"+objectID);
        $.ajax(
            {
                type: 'get',
                url: '${request.contextPath }/comment/getCommentsByObjectID?ObjectID='+objectID,
                async: true,
                dataType:"json",
                success: function(data) {
                    console.log("评论获取成功"+data);
                    if(data !=null) {
                        var comments = "";//<ul class='nav'>
                        $.each(data,function(index,element){
                            console.log(element['commentID']);
                            comments +=
                                "<div class='media'>"+
                                    "<a class='pr-3' href=''>"+
                                    "<img class='rounded' src='"+element['user']['avatarPath']+"' alt='头像' width='75px'/>"+
                                    "</a>"+
                                    "<div class='media-body'>"+
                                        "<h5 class='mt-0'>"+element['user']['userName']+"</h5>"+"经验值:"+element['xp']+
                                            /*评论内容*/
                                            element['content']+
                                   " </div>"+
                                "</div>"+
                                    "点赞:" +element['likes']+
                                    "反对："+ element['opposition']+
                                    "实名支持："+element['realNameSupport']+
                                    "实名反对："+element['realNameOpposition']+
                                    "评论时间" +element['commentTime']+
                                "<hr />"
                        });
                        console.log(comments);
                        $('#commentArea').append(comments)//追加数据
                    } else {
                        alert("error");
                    }
                },
                error: function() {
                    alert("网络错误");
                }
            }
        )
    }
</script>
</html>